<!DOCTYPE html>
<html>
<head>
<title>Hooper Reaction</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(135deg, #0a0a0a 0%, #004400 50%, #0a0a0a 100%); /* Court-like gradient */
    font-family: Arial, sans-serif;
    color: white;
    user-select: none;
}

/* MENU */
#menu {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex; /* Default display for start */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    text-align: center;
}

.menu-title {
    font-size: clamp(40px, 8vw, 60px);
    color: orange;
    font-weight: 900;
    text-shadow: 0 0 20px #ff8800;
    margin-bottom: 10px;
}

.menu-subtitle {
    font-size: clamp(16px, 4vw, 24px);
    color: #ccc;
    margin-bottom: 20px;
}

.menu-btn {
    background: linear-gradient(45deg, orange, #ffb44d);
    border: none;
    padding: 15px 40px;
    font-size: clamp(18px, 4vw, 24px);
    border-radius: 15px;
    cursor: pointer;
    font-weight: 900;
    transition: 0.3s;
    box-shadow: 0 4px 10px rgba(255, 165, 0, 0.5);
}
.menu-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(255, 165, 0, 0.7);
}

/* NAME INPUT */
#nameInput {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}
.name-box {
    padding: 12px;
    font-size: 20px;
    border-radius: 8px;
    border: 2px solid orange;
    width: clamp(200px, 50vw, 300px);
    text-align: center;
    outline: none;
    background: #222;
    color: white;
}

/* GAME AREA */
#game {
    display: none; /* Hidden by default */
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
}

#scoreHUD {
    position: absolute;
    top: 10px;
    left: 15px;
    font-size: clamp(20px, 5vw, 28px);
    color: white;
    font-weight: 800;
}
#missHUD {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: clamp(20px, 5vw, 28px);
    color: red;
    font-weight: 800;
}
#comboHUD {
    position: absolute;
    top: 60px;
    left: 15px;
    font-size: clamp(18px, 4vw, 24px);
    color: #00eaff;
    font-weight: 800;
}

/* TARGET BASKETBALL (CSS-drawn) */
#circle {
    width: 90px;
    height: 90px;
    background: radial-gradient(circle, orange 40%, #ff6600 60%);
    border-radius: 50%;
    position: absolute;
    display: none;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(255, 165, 0, 0.8);
}
/* Add basketball seams */
#circle::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 10px;
    width: 70px;
    height: 50px;
    border: 3px solid black;
    border-radius: 50%;
    background: transparent;
}
#circle::after {
    content: '';
    position: absolute;
    top: 10px;
    left: 20px;
    width: 50px;
    height: 70px;
    border: 3px solid black;
    border-radius: 50%;
    background: transparent;
}

/* Hit explosion */
#spread {
    position: absolute;
    width: 0;
    height: 0;
    background: rgba(255, 165, 0, 0.45);
    border-radius: 50%;
    display: none;
    animation: explode 0.3s ease-out forwards;
}
@keyframes explode {
    0% { width: 0; height: 0; opacity: 1; }
    100% { width: 200px; height: 200px; opacity: 0; }
}

/* GAME OVER + LEADERBOARD */
#gameOver {
    display: none; /* Hidden by default */
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 25px;
    font-size: clamp(24px, 6vw, 30px);
    font-weight: 700;
    text-align: center;
}
.restart-btn, .menu-btn-small, .clear-btn {
    padding: 12px 35px;
    font-size: 22px;
    font-weight: 900;
    border: none;
    background: orange;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.2s;
}
.restart-btn:hover, .menu-btn-small:hover, .clear-btn:hover {
    background: #ffb44d;
}
.clear-btn {
    background: red;
}
.clear-btn:hover {
    background: #ff6666;
}

/* Leaderboard box */
#leaderboard {
    background: #111;
    padding: 15px 25px;
    border-radius: 10px;
    color: white;
    font-size: clamp(16px, 4vw, 20px);
    max-height: 300px;
    overflow-y: auto;
    width: clamp(250px, 80vw, 400px);
}
#leaderboard strong { /* Added styling for scores in leaderboard */
    color: orange;
    font-weight: 900;
}

/* Mobile fullscreen hint */
@media (max-width: 768px) {
    body { font-size: 14px; }
    .menu-title { font-size: 50px; }
}
</style>
</head>
<body>

<div id="menu">
    <div class="menu-title">üèÄ HOOPER REACTION</div>
    <div class="menu-subtitle">Choose your device mode for optimal play! Mobile: Harder (faster taps). Laptop: Easier (more time to click).</div>
    <button class="menu-btn" onclick="setDeviceMode('mobile')">Mobile Mode</button>
    <button class="menu-btn" onclick="setDeviceMode('laptop')">Laptop Mode</button>
    <div id="modeSelected" style="display:none; display: flex; flex-direction: column; align-items: center; gap: 20px;">
        <button class="menu-btn" onclick="selectMode(1)">1-Player Mode</button>
        <button class="menu-btn" onclick="selectMode(2)">2-Player Mode</button>
        <button class="menu-btn" onclick="viewLeaderboard()">View Leaderboard</button>
    </div>

    <div id="nameInput">
        <input id="playerName1" class="name-box" placeholder="Player 1 Name" maxlength="20">
        <input id="playerName2" class="name-box" placeholder="Player 2 Name (2-Player Only)" maxlength="20" style="display:none;">
        <button class="menu-btn" onclick="startGame()">START GAME</button>
    </div>
</div>

<div id="game">
    <div id="scoreHUD">Score: 0 | 0</div>
    <div id="missHUD">Miss: 0 | 0</div>
    <div id="comboHUD">Combo: 0 | 0</div>

    <div id="circle"></div>
    <div id="spread"></div>
</div>

<div id="gameOver">
    <div id="finalScoreText"></div>
    <div>üèÜ LEADERBOARD</div>
    <div id="leaderboard"></div>
    <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <button class="restart-btn" onclick="restart()">Play Again</button>
        <button class="menu-btn-small" onclick="backToMenu()">Back to Menu</button>
        <button class="clear-btn" onclick="clearLeaderboard()">Clear Leaderboard</button>
    </div>
</div>

<audio id="swish" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_7c75c2b2a7.mp3" type="audio/mpeg">
</audio>

<script>
// Global DOM references
const menu = document.getElementById("menu");
const game = document.getElementById("game");
const overScreen = document.getElementById("gameOver");
const circle = document.getElementById("circle");
const spread = document.getElementById("spread");
const scoreHUD = document.getElementById("scoreHUD");
const missHUD = document.getElementById("missHUD");
const comboHUD = document.getElementById("comboHUD");
const finalScoreText = document.getElementById("finalScoreText");
const swish = document.getElementById("swish");
const leaderboardBox = document.getElementById("leaderboard");
const nameInput = document.getElementById("nameInput");
const playerName2 = document.getElementById("playerName2");
const modeSelected = document.getElementById("modeSelected");

// Variables for device mode and game parameters
let deviceMode = null;
let SPAWN_TIME;
let CIRCLE_SIZE;
let PADDING;

const SPAWN_DELAY = 120;
const MAX_MISSES = 3;
const MAX_CLICKS_2P = 10;

// Game state variables
let score = [0, 0];
let misses = [0, 0];
let combo = [0, 0];
let timer = null;
let currentPlayer = 0;
let mode = 1; // 1-Player or 2-Player
let names = ["", ""];
let gameClicks = 0;

// Initialize on load
function init() {
    overScreen.style.display = "none";
    game.style.display = "none";
    menu.style.display = "flex";
    // Hide mode selection and name input initially
    modeSelected.style.display = "none"; 
    nameInput.style.display = "none";
}
init(); 

// SET DEVICE MODE
function setDeviceMode(selectedMode) {
    deviceMode = selectedMode;
    // Set constants based on mode
    if (deviceMode === 'mobile') {
        SPAWN_TIME = 800; // Harder: less time
        CIRCLE_SIZE = 90;
        PADDING = 150; 
    } else { // 'laptop' or fallback
        SPAWN_TIME = 1000; // Easier: more time
        CIRCLE_SIZE = 100;
        PADDING = 140; 
    }
    // Apply circle size
    circle.style.width = CIRCLE_SIZE + "px";
    circle.style.height = CIRCLE_SIZE + "px";
    
    // Show next menu options
    // Must override the initial 'style="display:none;"' inline attribute
    modeSelected.style.display = "flex"; 
}

// SELECT MODE
function selectMode(selectedMode) {
    mode = selectedMode;
    if (mode === 2) {
        playerName2.style.display = "block";
    } else {
        playerName2.style.display = "none";
    }
    nameInput.style.display = "flex";
}

// VIEW LEADERBOARD
function viewLeaderboard() {
    menu.style.display = "none";
    overScreen.style.display = "flex";
    loadLeaderboard();
}

// START GAME
function startGame() {
    names[0] = document.getElementById("playerName1").value.trim() || "Player 1";
    if (mode === 2) {
        names[1] = playerName2.value.trim() || "Player 2";
    }

    // Hide menus, show game
    menu.style.display = "none";
    overScreen.style.display = "none";
    game.style.display = "block";

    // Reset game state
    score = [0, 0];
    misses = [0, 0];
    combo = [0, 0];
    currentPlayer = 0;
    gameClicks = 0;

    updateHUD();
    spawnCircle();
}

// UPDATE HUD
function updateHUD() {
    scoreHUD.textContent = "Score: " + score[0] + (mode === 2 ? " | " + score[1] : "");
    missHUD.textContent = "Miss: " + misses[0] + (mode === 2 ? " | " + misses[1] : "");
    comboHUD.textContent = "Combo: " + combo[0] + (mode === 2 ? " | " + combo[1] : "");
}

// SPAWN BASKETBALL
function spawnCircle() {
    circle.style.display = "block";

    // Calculate safe spawning area
    const maxX = window.innerWidth - CIRCLE_SIZE - PADDING;
    const maxY = window.innerHeight - CIRCLE_SIZE - PADDING;
    const x = Math.random() * (maxX - PADDING) + PADDING;
    const y = Math.random() * (maxY - PADDING) + PADDING;

    circle.style.left = x + "px";
    circle.style.top = y + "px";

    clearTimeout(timer);
    timer = setTimeout(() => miss(), SPAWN_TIME);
}

// MISS (Target not clicked in time)
function miss() {
    circle.style.display = "none";
    misses[currentPlayer]++;
    combo[currentPlayer] = 0;

    updateHUD();

    // Check for Game Over condition
    if (misses[currentPlayer] >= MAX_MISSES || (mode === 2 && gameClicks >= MAX_CLICKS_2P)) {
        gameOver();
    } else {
        // Switch player in 2-player mode
        if (mode === 2) currentPlayer = 1 - currentPlayer;
        spawnCircle();
    }
}

// CLICK BASKETBALL
function handleClick() {
    clearTimeout(timer);

    try {
        swish.currentTime = 0;
        swish.play();
    } catch (e) {
        console.warn("Audio failed:", e);
    }

    let points = 1;
    if (combo[currentPlayer] >= 5) points = 2; // Bonus points for combo
    score[currentPlayer] += points;
    combo[currentPlayer]++;
    gameClicks++;

    updateHUD();

    const rect = circle.getBoundingClientRect();
    hitEffect(rect.left + CIRCLE_SIZE / 2, rect.top + CIRCLE_SIZE / 2);

    circle.style.display = "none";

    setTimeout(() => {
        // Check for Game Over condition
        if (mode === 2 && gameClicks >= MAX_CLICKS_2P) {
            gameOver();
        } else {
            // Switch player in 2-player mode
            if (mode === 2) currentPlayer = 1 - currentPlayer;
            spawnCircle();
        }
    }, SPAWN_DELAY);
}

// Attach click/touch listeners
circle.addEventListener("click", handleClick);
circle.addEventListener("touchstart", handleClick);

// HIT EFFECT
function hitEffect(x, y) {
    spread.style.display = "block";
    spread.style.left = (x - 100) + "px";
    spread.style.top = (y - 100) + "px";
    setTimeout(() => spread.style.display = "none", 300);
}

// GAME OVER
function gameOver() {
    // Stop game play
    clearTimeout(timer);
    circle.style.display = "none";
    game.style.display = "none";
    overScreen.style.display = "flex";

    let winner = "";
    if (mode === 1) {
        finalScoreText.textContent = names[0] + "'s Final Score: " + score[0];
    } else {
        const p1Score = score[0];
        const p2Score = score[1];
        if (p1Score > p2Score) winner = names[0] + " wins!";
        else if (p2Score > p1Score) winner = names[1] + " wins!";
        else winner = "It's a tie!";
        finalScoreText.innerHTML = `**${names[0]}**: ${p1Score} | **${names[1]}**: ${p2Score} <br/> Result: ${winner}`;
    }

    saveScore();
    loadLeaderboard();
}

// LEADERBOARD: SAVE
function saveScore() {
    try {
        let board = JSON.parse(localStorage.getItem("hooperScores") || "[]");
        
        // Save scores based on mode
        if (mode === 1) {
            board.push({ name: names[0], score: score[0] });
        } else {
            board.push({ name: names[0], score: score[0] });
            board.push({ name: names[1], score: score[1] });
        }
        
        board.sort((a, b) => b.score - a.score);
        board = board.slice(0, 10); // Keep only top 10
        localStorage.setItem("hooperScores", JSON.stringify(board));
    } catch (e) {
        console.error("Save failed:", e);
    }
}

// LEADERBOARD: LOAD (Improved display logic)
function loadLeaderboard() {
    try {
        let board = JSON.parse(localStorage.getItem("hooperScores") || "[]");
        board.sort((a, b) => b.score - a.score);
        
        if (board.length === 0) {
            leaderboardBox.innerHTML = "No scores recorded yet.";
            return;
        }

        leaderboardBox.innerHTML = board.map((p, i) => {
            return `${i + 1}. ${p.name} ‚Äî <strong>${p.score}</strong>`;
        }).join('<br>');

    } catch (e) {
        console.error("Load failed:", e);
        leaderboardBox.innerHTML = "Leaderboard unavailable.";
    }
}

// CLEAR LEADERBOARD
function clearLeaderboard() {
    if (confirm("Are you sure you want to clear the leaderboard? This action cannot be undone.")) {
        try {
            localStorage.removeItem("hooperScores");
            loadLeaderboard(); // Reload to show empty
        } catch (e) {
            console.error("Clear failed:", e);
        }
    }
}

// RESTART
function restart() {
    startGame();
}

// BACK TO MENU (CRITICAL FIX APPLIED)
function backToMenu() {
    overScreen.style.display = "none";
    game.style.display = "none";
    menu.style.display = "flex"; // Display the main menu
    
    // Reset secondary menu states
    modeSelected.style.display = "none"; 
    nameInput.style.display = "none";
    playerName2.style.display = "none";
}
</script>
</body>
</html>